# 任务列表：AI Canvas 完整集成方案

## Phase 1: 文档整合与现状分析

- [x] **整合提案文档** <!-- id: 0 -->
    - 分析两个现有提案的内容
    - 整合功能点和实现状态
    - 创建统一的中文提案文档

- [x] **代码审查** <!-- id: 1 -->
    - 检查代码实现状态
    - 识别已完成和未完成的功能
    - 发现缺失的组件和潜在问题

## Phase 2: 代码完善

- [x] **补充 LeftToolbar 组件** <!-- id: 2 -->
    - 检查 MainLayout 中的引用
    - 实现 LeftToolbar 组件
    - 集成 tldraw 标准工具按钮（Select、Hand、Draw）
    - 添加创建 AI Frame 的功能按钮
    - 验证组件正常工作（构建成功）

- [x] **修复潜在问题** <!-- id: 3 -->
    - 检查所有组件引用是否正确
    - 修复可能的运行时错误（删除未使用的旧文件：Canvas.tsx、CanvasNode.tsx、UIOverlay.tsx）
    - 确保所有导入路径正确（构建验证通过）

## Phase 3: 测试与验证

- [ ] **E2E 功能验证** <!-- id: 4 -->
    - 验证布局在不同屏幕尺寸下的表现
    - 测试侧边栏打开/关闭的动画和交互
    - 验证输入框在底部和侧边栏模式间的切换
    - 测试输入状态在不同模式间的持久化

- [ ] **生成流程验证** <!-- id: 5 -->
    - 测试从底部输入触发生成的完整流程
    - 测试从侧边栏输入触发生成的完整流程
    - 验证画布和侧边栏的状态同步
    - 测试错误处理和失败状态显示
    - 验证不同宽高比和分辨率的生成

- [ ] **边界情况测试** <!-- id: 6 -->
    - 测试空输入的处理
    - 测试快速连续生成的处理
    - 测试生成过程中关闭侧边栏的行为
    - 测试生成过程中删除 AI Frame 的行为
    - 测试网络错误模拟（如果 Mock 服务支持）

- [ ] **性能测试** <!-- id: 7 -->
    - 测试大量 AI Frame 的画布性能
    - 测试长聊天历史的渲染性能
    - 检查内存泄漏问题

## Phase 4: 文档完善

- [x] **更新项目文档** <!-- id: 8 -->
    - 更新 README.md 说明项目功能
    - 添加使用说明和示例
    - 更新架构文档（包含在 design.md 中）

- [x] **代码注释完善** <!-- id: 9 -->
    - 为关键函数添加 JSDoc 注释（MainLayout、MockGenerationService、AIFrameShapeUtil）
    - 补充复杂逻辑的说明注释
    - 确保代码可读性

## Phase 5: 优化与打磨

- [ ] **用户体验优化** <!-- id: 10 -->
    - 优化加载动画和过渡效果
    - 改进错误提示的友好性
    - 优化响应式布局细节

- [ ] **代码质量提升** <!-- id: 11 -->
    - 代码格式化和 lint 检查
    - 提取重复代码为公共函数
    - 优化类型定义

## Phase 6: 视口控制与开发者工具

- [x] **视口状态管理** <!-- id: 12 -->
    - 在 store.ts 中添加 `showSafeViewport` 状态
    - 实现该状态的持久化 (persist)
    - 确保与现有 debugRowMaxWidth 状态兼容

- [x] **视口逻辑实现** <!-- id: 13 -->
    - 实现安全视口计算函数 `calculateSafeViewport` (动态 padding)
    - 实现 `shouldFitViewport` 判定逻辑 (规则 A/B)
    - 实现 `calculateUnionBounds` 逻辑
    - 应用 300ms 缓动过渡效果

- [x] **Debug UI 增强** <!-- id: 14 -->
    - 将 SystemDebugDrawer 入口改为顶部导航栏 "开发者模式"
    - 添加 "展示安全视口" 开关
    - 实现安全视口可视化 Overlay (半透明层)

## 验证清单

完成所有任务后，需要验证以下功能点：

### 基础功能
- [ ] 可以在画布上创建 AI Frame
- [ ] 可以从底部输入框输入提示词并生成
- [ ] 可以从侧边栏输入框输入提示词并生成
- [ ] 生成过程中显示加载状态
- [ ] 生成成功后显示图片
- [ ] 生成失败时显示错误信息

### UI 交互
- [ ] 侧边栏可以正常打开和关闭
- [ ] 打开侧边栏时底部输入框隐藏
- [ ] 关闭侧边栏时底部输入框显示
- [ ] 输入状态在不同模式间正确同步
- [ ] 设置选项（宽高比、分辨率）正常工作

### 状态同步
- [ ] 生成时同时更新侧边栏和画布
- [ ] 聊天历史正确显示
- [ ] 画布上的 AI Frame 状态正确更新
- [ ] 多个生成任务不会互相干扰

### 错误处理
- [ ] 空输入不会触发生成
- [ ] 生成失败时正确显示错误
- [ ] 删除 Frame 后不会出现错误
- [ ] 网络错误时正确处理
